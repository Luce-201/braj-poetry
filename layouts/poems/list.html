{{ define "main" }}
<div class="list-page">

  <header class="list-header">
    <h1>कविताएँ <span class="en">Poems</span></h1>
    <p id="poem-count">{{ len .Pages }} कविताएँ / poems</p>
  </header>

  <div class="filter-bar">
    <div class="filter-group">
      <label>विषय / Theme:</label>
      <div class="theme-filter-tags">
        <button class="theme-btn active" onclick="setTheme('', this)">सभी / All</button>
        {{ range .Site.Taxonomies.themes }}
          <button class="theme-btn" onclick="setTheme(this.dataset.theme, this)" data-theme="{{ .Page.Title }}">{{ .Page.Title }}</button>
        {{ end }}
      </div>
    </div>
  </div>

  <div class="poem-grid" id="poem-grid">
    {{ range .Pages }}
      {{ $themes := "" }}
      {{ if .Params.themes }}
        {{ $themes = delimit .Params.themes "|" }}
      {{ end }}
      <div class="poem-card-wrapper" data-themes="{{ $themes }}">
        {{ partial "poem-card.html" . }}
      </div>
    {{ end }}
  </div>

  <p id="no-results" class="empty-msg" style="display:none;">
    कोई कविता नहीं मिली / No poems found for this filter.
  </p>

</div>

<script>
  let activeTheme = '';

  function filterPoems() {
    const wrappers = document.querySelectorAll('.poem-card-wrapper');
    let visible = 0;
    wrappers.forEach(function(wrapper) {
      const themes = wrapper.dataset.themes || '';
      const themeList = themes === '' ? [] : themes.split('|').map(function(t) { return t.trim(); });
      const match = !activeTheme || themeList.includes(activeTheme);
      wrapper.style.display = match ? '' : 'none';
      if (match) visible++;
    });
    document.getElementById('poem-count').textContent = visible + ' कविताएँ / poems';
    document.getElementById('no-results').style.display = visible === 0 ? 'block' : 'none';
  }

  function setTheme(theme, btn) {
    activeTheme = theme;
    document.querySelectorAll('.theme-btn').forEach(function(b) { b.classList.remove('active'); });
    btn.classList.add('active');
    filterPoems();
  }
</script>
{{ end }}
